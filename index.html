<!DOCTYPE html>

<!-- 秋高秋高考査村 -->
<!-- Ver.1.0.0 -->
<!-- 2025/07/31 -->

<!-- Admin Password = 0611 -->

<html lang="ja">
<head>


  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-471J8G71L3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-471J8G71L3');
  </script>


  <meta charset="UTF-8" />
  <meta name="viewport" content="width=1200" />
  <meta name="description" content="無料・完全匿名で使える過去問共有サイトです。考査以外の問題も共有できます。情報交換のための掲示板も用意してあります。">
  <title>秋高考査村 - 過去問共有サービス</title>
  <link rel="icon" href="/assets/icon.png">
  <link rel="stylesheet" href="assets/css/common.css" />
  <link rel="stylesheet" href="assets/css/pages/index.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <style>
    /* 印刷用テンプレートモーダルのダウンロードリンクホバー効果 */
    #printTemplateModal a:hover {
      background: #e9ecef !important;
      border-color: #adb5bd !important;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="header-title">
        <div class="site-title">秋高考査村</div>
        <div class="site-subtitle">無料・匿名で使える過去問共有サイト</div>
      </div>
      <div id="freeModeStatus" class="free-mode-status"></div>
      <nav>
        <ul>
          <li><a href="index.html" class="active"><i class="fa-solid fa-home"></i> ホーム</a></li>
          <li><a href="pages/upload.html"><i class="fa-solid fa-upload"></i> アップロード</a></li>
          <li><a href="pages/search.html"><i class="fa-solid fa-database"></i> 問題データベース</a></li>
          <li><a href="pages/share.html"><i class="fa-solid fa-share-nodes"></i> 共有・拡散</a></li>
          <li><a href="https://c.kuku.lu/hmc853pz" target="_blank"><i class="fa-solid fa-comments"></i> 匿名掲示板</a></li>
          <li><a href="https://forms.gle/ZWtQCvecH4eZtTEU7" target="_blank"><i class="fa-solid fa-envelope"></i> 報告・問い合わせ</a></li>
        </ul>
      </nav>
    </div>
  </header>

  

    <div id="redirect-message" style="display:none; text-align:center; background:#fffbe6; color:#b8860b; font-size:32px; font-weight:bold; padding:32px 0; border-bottom:1px solid #ffe58f; margin-top:80px;">スマホ版に転送中...</div>
    
    <div id="mock-button" style="margin-top:3rem;width:100%;text-align:center;margin-top:32px;margin-bottom:16px;">
      <a href="#" style="display:inline-block;padding:10px 28px;font-size:20px;background:#0071e3;color:#fff;border-radius:8px;text-decoration:none;box-shadow:0 2px 8px rgba(0,0,0,0.10);pointer-events:none;opacity:0.6;">
        <i class="fa-solid fa-user-shield" style="margin-right:0.6em; zoom:1.3; " ></i>管理画面へ
      </a>
    </div>

    <main id="main-content">
                        <h1 class="hero-title">秋高考査村へようこそ</h1>
      <div class="subtitle">考査問題に限らず、匿名で過去問を共有・検索できます</div>

      <div class="card">
        <p style="margin-top:1.5rem;">問題をアップロードすると、広告フリーモードが24時間追加されます。</p>
        <div class="card-buttons">
          <a href="pages/upload.html">
            <i class="fa-solid fa-upload"></i>
            <span>提供</span>
          </a>
          <a href="pages/search.html">
            <i class="fa-solid fa-database"></i>
            <span>検索</span>
          </a>
          <a href="https://c.kuku.lu/hmc853pz" target="_blank">
            <i class="fa-solid fa-comments"></i>
            <span>匿名掲示板</span>
          </a>
        </div>
        <div class="card-info-text">
          <ul class="info-list">
            <li>
              <span class="info-icon"><i class="fa-regular fa-file-pdf"></i></span>
              <span>PDFまたは画像で共有できます<span class="info-note">（Word・Excel・一太郎には順次対応予定）</span></span>
            </li>
            <li style="flex-direction: column; align-items: flex-start; gap: 0.3em;">
              <div style="display: flex; align-items: center; gap: 0.7em;">
                <span class="info-icon"><i class="fa-solid fa-paper-plane"></i></span>
                <span>アップロード画面から送信していただきたい試験例</span>
              </div>
              <div class="info-examples">定期考査・実力テスト・確認テスト など</div>
            </li>
            <li style="flex-direction: column; align-items: flex-start; gap: 0.3em;">
              <div style="display: flex; align-items: center; gap: 0.7em;">
                <span class="info-icon"><i class="fa-solid fa-comments"></i></span>
                <span>週間テストや確認プリントなどは</span><span class="info-bold">掲示板</span>で！
              </div>
            </li>
          </ul>
        </div>
      </div>
      
      <!-- 統計情報セクション -->
      <div class="stats-section">
        <h2 class="section-title">統計情報</h2>
        
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number" id="totalPosts">-</div>
            <div class="stat-label">投稿数</div>
          </div>
          
          <div class="stat-card">
            <div class="stat-number" id="totalLikes">Loading</div>
            <div class="stat-label">いいね数</div>
          </div>
          
          <div class="stat-card">
            <div class="stat-number" id="activeUsers">-</div>
            <div class="stat-label">訪問者数</div>
          </div>
        </div>
      </div>
      
      <!-- お伝えしたいことカード -->
      <div class="dynamic-card" id="notice-card">
        <div class="card-title">考査村をご利用の皆様にお伝えしたいことがあります</div>
        <div style="display: flex; justify-content: center;">
          <div style="width: 100%; max-width: 700px; aspect-ratio: 16/9;">
            <video controls style="width: 100%; height: 100%; background: #000;">
              <source src="assets/考査村ビデオ.mp4" type="video/mp4">
              お使いのブラウザは動画再生に対応していません。
            </video>
          </div>
        </div>
      </div>

      <!-- 更新履歴カード -->
      <div class="dynamic-card" id="history-card">
        <div class="card-title">更新履歴</div>
        <ul class="history-list">
          <li class="history-item"><span class="history-date">2025/08/05</span><span class="history-desc">　サーバー移行 新システムでの運用開始</span></li>
          <li class="history-item"><span class="history-date">2025/06/12</span><span class="history-desc">　PDF結合ロジック修正</span></li>
          <li class="history-item"><span class="history-date">2024/07/21</span><span class="history-desc">　評価システム導入</span></li>
          <li class="history-item"><span class="history-date">2024/07/20</span><span class="history-desc">　匿名掲示板オープン　詳細については、下を御覧ください。</span></li>
          <li class="history-item"><span class="history-date">2024/06/26</span><span class="history-desc">　サービス開始</span></li>
        </ul>
      </div>

      <!-- 匿名掲示板についてカード -->
      <div class="dynamic-card" id="bbs-card" style="background:#f8fafd; border:1.5px solid #b5d0e6; margin-top:2.2rem;">
        <div class="card-title" style="color:#0071e3;">匿名掲示板について（外部サービス使用）</div>
        <div style="padding:1.2em 1.5em; text-align:left; font-size:1.08em; line-height:1.8;">
          これら掲示板では、主に次のような情報を共有することを目的として用意しました。
          完全匿名ですぐに利用できます。<br><br>
          <strong class="info-highlight">★平均点の報告</strong><br>
          　クラス平均点100点を目指そう！<br>　高い平均点を報告してください。 <br><br>
          <strong class="info-highlight">★テストの共有（写真投稿機能あり）</strong><br><br>
          <strong class="info-highlight">★過去問とほとんど一致している科目の情報交換</strong><br><br>
          <strong class="info-highlight">★試験への対策について。</strong><br><br><br>
          <strong class="info-highlight" style="text-align: center;">掲示板リンク</strong><br>
          <div style="margin: 12px 0 0 0; display: flex; flex-direction: column; gap: 16px;">
            <button class="bbs-btn" onclick="window.open('https://c.kuku.lu/hmc853pz', '_blank')">
              <i class="fa-solid fa-comments"></i>
              <span>全体の部屋</span>
            </button>
            <button class="bbs-btn" onclick="window.open('https://c.kuku.lu/wxamr3rk', '_blank')">
              <i class="fa-solid fa-users"></i>
              <span>３年生の部屋</span>
            </button>
            <button class="bbs-btn" onclick="window.open('https://c.kuku.lu/shwzzu7z', '_blank')">
              <i class="fa-solid fa-users"></i>
              <span>２年生の部屋</span>
            </button>
            <button class="bbs-btn" onclick="window.open('https://c.kuku.lu/xpgpbn7k', '_blank')">
              <i class="fa-solid fa-users"></i>
              <span>１年生の部屋</span>
            </button>
            <button class="bbs-btn" onclick="window.open('https://c.kuku.lu/rk6hxege', '_blank')">
              <i class="fa-solid fa-user-tie"></i>
              <span>運営者と話す部屋</span>
            </button>
          </div>
        </div>
      </div>

      <!-- このサービスについてカード -->
      <div class="dynamic-card" id="about-card" style="background:#f7fff7; border:1.5px solid #b5e6b5; margin-top:2.2rem;">
        <div class="card-title" style="color:#00a060;">このサービスについて</div>
        <div style="padding:1.2em 1.5em; text-align:justify; font-size:1.08em; line-height:1.8;">
          私が1年生で受けた「歴史総合」の考査を前年の問題と比較したところ、年度の数字が一つ増えただけでした。さらに、2年生で受けた「公共」の試験問題は、過去問と一致している部分が8割を超えていました。評定に関わる考査で、いくら授業が同じ内容だとはいえ前年の問題をほとんど同じく出題すべきではないと考えます。入試に関わらない教科であっても、過去問を手に入れることで勉強時間を他の重要な科目に充てることができます。<br><br>
          このサービスは、先輩とのつながりがない人でも過去問を利用できることを目指し、平均点を異常に高くし、将来的にコピペしただけの考査問題を絶滅させることを目的としたプロジェクトです。<br><br>
          このサービスは個人で運営しています。サービス維持には皆さんのご協力が必要です。ぜひ、過去問のアップロードやこのサイトの共有・拡散をよろしくお願いします。<br>
        </div>
      </div>

             <!-- 概要・問い合わせカード -->
       <div class="dynamic-card" id="info-card">
         <div class="card-title">共有</div>
         <!-- 共有・拡散コンテンツここから（カードで囲わず中身のみ） -->
         <div style="font-size:1.13rem; color:#333; margin-bottom:1.2em; line-height:1.7;">
           秋高考査村を友達やクラス、学校に広めよう！
         </div>
                 <div style="margin:1.2em 0 0.5em 0; display:flex; gap:0.5em; align-items:center; justify-content:center; flex-wrap:wrap;">
           <input type="text" id="siteUrl" class="share-url-input" value="https://akt-kosamura.github.io/kosamura/?OpenExternalBrowser=1?OpenExternalBrowser=1" readonly style="width:25em; max-width:90vw; font-size:1.05em; padding:0.5em 0.7em; border:1px solid #d1d1d6; border-radius:8px; background:#f9f9fb; color:#333; text-align:center;">
         </div>
        <div style="display:flex; justify-content:center; margin-bottom:0.5em;">
          <button class="copy-btn" id="copyBtn" onclick="copyButton('siteUrl')" style="background:var(--accent); color:#fff; border:none; border-radius:8px; padding:0.5em 1.2em; font-size:1em; cursor:pointer; transition:background 0.2s; margin-left:0.2em; display:flex; align-items:center; gap:0.5em;"><i class="fa-regular fa-copy"></i> コピー</button>
        </div>
        <div style="height:2.2em; width:100%; display:flex; align-items:center; justify-content:center; margin-bottom:1.2em;">
          <div id="copyToast" style="display:none; opacity:0; background:#fff; color:#111; padding:0.35em 1em; border-radius:1em; font-size:0.93em; min-width:6em; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.13); transition:opacity 0.4s; pointer-events:none; font-weight:normal; letter-spacing:0.01em;">コピーしました！</div>
        </div>
        <div class="share-buttons" style="display:flex; flex-wrap:wrap; gap:1em; justify-content:center; margin-bottom:1.2em;">
          <a
            id="twitterBtn"
            href="https://twitter.com/intent/tweet?text=無料で使える過去問共有サイト「秋高考査村」%0A考査問題に限らず、テスト問題をアップロード・閲覧できるサービスです。%0A%0Ahttps://akt-kosamura.github.io/kosamura/?OpenExternalBrowser=1%0A%0A%23考査村%20%23過去問"
            class="share-btn"
            style="background:#fff; color:var(--accent); border:1.5px solid var(--accent); border-radius:8px; font-size:1.05rem; font-weight:bold; cursor:pointer; padding:0.7rem 1.5rem; transition:background 0.2s, color 0.2s; display:flex; align-items:center; gap:0.5em; text-decoration:none;"
            target="_blank" rel="noopener noreferrer"
          >
            <i class="fa-brands fa-twitter"></i><span style="margin-left:0.5em;">ツイート</span>
          </a>
          <button class="share-btn" id="nativeShareBtn" style="background:#fff; color:var(--accent); border:1.5px solid var(--accent); border-radius:8px; font-size:1.05rem; font-weight:bold; cursor:pointer; padding:0.7rem 1.5rem; transition:background 0.2s, color 0.2s; display:flex; align-items:center; gap:0.5em;"><i class="fa-solid fa-share-nodes"></i><span style="margin-left:0.5em;">共有</span></button>
        </div>
        <button class="print-btn" onclick="showPrintTemplateModal()" style="display:block; margin:1.2rem auto 0 auto; padding:0.7rem 2.2rem; background:#fff; color:var(--accent); border:1.5px solid var(--accent); border-radius:8px; font-size:1.05rem; font-weight:bold; cursor:pointer; transition:background 0.2s, color 0.2s;"><i class="fa-solid fa-print"></i> 印刷用テンプレートを見る（印刷して共有）</button>
        <div style="margin-top:1.5em; color:#888; font-size:0.98em;">
          ※元データもあるので、自由に編集、配布していただいて構いません。
        </div><br>
        <!-- 共有・拡散コンテンツここまで -->
        <div class="info-buttons">
          <a href="https://forms.gle/ZWtQCvecH4eZtTEU7" target="_blank"><i class="fa-solid fa-envelope"></i> 問い合わせフォーム</a><Br> 
        </div>
    </div>

      <!-- 印刷用テンプレートモーダル -->
      <div id="printTemplateModal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); align-items:center; justify-content:center;">
        <div style="background:#fff; border-radius:12px; padding:24px 18px 18px 18px; box-shadow:0 4px 24px rgba(0,0,0,0.18); min-width:300px; max-width:90vw; text-align:center;">
          <div style="font-size:1.2em; margin-bottom:20px; font-weight:bold; color:#333;">印刷用テンプレート</div>
          <div style="margin-bottom:20px; text-align:left;">
            <p style="margin-bottom:15px; color:#666;">以下のリンクから印刷用テンプレートをダウンロードできます：</p>
            <div style="display:flex; flex-direction:column; gap:12px;">
              <a href="assets/documents/ミニカード.pdf" download style="display:flex; align-items:center; gap:10px; padding:12px 16px; background:#f8f9fa; border:1px solid #dee2e6; border-radius:8px; text-decoration:none; color:#333; transition:background 0.2s;">
                <i class="fa-regular fa-file-pdf" style="color:#dc3545; font-size:1.2em;"></i>
                <span>1. ミニカード (.pdf)</span>
              </a>
              <a href="assets/documents/短冊.pdf" download style="display:flex; align-items:center; gap:10px; padding:12px 16px; background:#f8f9fa; border:1px solid #dee2e6; border-radius:8px; text-decoration:none; color:#333; transition:background 0.2s;">
                <i class="fa-regular fa-file-pdf" style="color:#dc3545; font-size:1.2em;"></i>
                <span>2. 短冊型PDF (.pdf)</span>
              </a>
                             <a href="assets/documents/宣伝用.jtd" download style="display:flex; align-items:center; gap:10px; padding:12px 16px; background:#f8f9fa; border:1px solid #dee2e6; border-radius:8px; text-decoration:none; color:#333; transition:background 0.2s;">
                 <img src="assets/jtd_icon.gif" alt="一太郎アイコン" style="width:1.2em; height:1.2em; object-fit:contain;">
                 <span>3. 元ファイル (.jtd)　 ※複数シート</span>
               </a>
            </div>
          </div>
          <button id="printTemplateClose" style="background:#6c757d; color:#fff; padding:8px 20px; border:none; border-radius:6px; font-size:1em; cursor:pointer;">閉じる</button>
        </div>
      </div>

      <!-- 管理者画面ボタンとモーダルここから -->
    <div style="width:100%;text-align:center;margin-top:32px;margin-bottom:16px;">
      <a href="#" id="adminLoginBtn" style="display:inline-block;padding:10px 28px;font-size:20px;background:#0071e3;color:#fff;border-radius:8px;text-decoration:none;box-shadow:0 2px 8px rgba(0,0,0,0.10);">
        <i class="fa-solid fa-user-shield" style="margin-right:0.6em;"></i>管理画面へ
      </a>
    </div>
    <div id="adminLoginModal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); align-items:center; justify-content:center;">
      <div style="background:#fff; border-radius:12px; padding:24px 18px 18px 18px; box-shadow:0 4px 24px rgba(0,0,0,0.18); min-width:260px; max-width:90vw; text-align:center;">
        <div style="font-size:1.1em; margin-bottom:10px;">暗証番号</div>
        <input id="adminPinInput" type="password" inputmode="numeric" maxlength="4" pattern="[0-9]*" style="font-size:2em; text-align:center; letter-spacing:0.5em; width:7em; margin-bottom:12px;" autocomplete="one-time-code" />
        <div id="adminPinError" style="color:#d33; font-size:0.95em; min-height:1.5em; margin-bottom:8px;"></div>
        <div style="display:grid; grid-template-columns:repeat(3,48px); gap:8px; justify-content:center; margin-bottom:10px;">
          <button class="pin-btn">1</button><button class="pin-btn">2</button><button class="pin-btn">3</button>
          <button class="pin-btn">4</button><button class="pin-btn">5</button><button class="pin-btn">6</button>
          <button class="pin-btn">7</button><button class="pin-btn">8</button><button class="pin-btn">9</button>
          <div></div><button class="pin-btn">0</button><button class="pin-btn" id="pinDelBtn">⌫</button>
        </div>
        <button id="adminPinSubmit" style="background:#0071e3;color:#fff;padding:6px 24px;border:none;border-radius:6px;font-size:1.1em;">OK</button>
        <button id="adminPinCancel" style="margin-left:1em; background:#eee;color:#333;padding:6px 18px;border:none;border-radius:6px;font-size:1.1em;">キャンセル</button>
      </div>
      </div>
      <!-- 管理者画面ボタンとモーダルここまで -->

    </main>
    <div class="copyright-note">Copyright© 2024 考査村 All Rights Reserved.</div><br><br>
  </div>

  <script src="assets/js/api.js"></script>
  <script>
    // Intersection Observerでカードをアニメーション表示
    document.addEventListener('DOMContentLoaded', function() {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.15 });
      document.querySelectorAll('.card, .dynamic-card').forEach(card => {
        observer.observe(card);
      });
    });

    // フリーモード管理（既存）
    function isInFreeMode() {
      const freeModeEnd = localStorage.getItem('freeModeEnd');
      if (!freeModeEnd) return false;
      return new Date().getTime() < parseInt(freeModeEnd);
    }
    function updateFreeModeStatus() {
      const status = document.getElementById('freeModeStatus');
      if (!status) return;
      if (isInFreeMode()) {
        const freeModeEnd = parseInt(localStorage.getItem('freeModeEnd'));
        const remaining = freeModeEnd - new Date().getTime();
        if (remaining <= 0) {
          localStorage.removeItem('freeModeEnd');
          status.textContent = '問題アップロードで広告フリー';
          status.className = 'free-mode-status ad';
          return;
        }
        const hours = Math.floor(remaining / (60 * 60 * 1000));
        const minutes = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000));
        const seconds = Math.floor((remaining % (60 * 1000)) / 1000);
        status.textContent = `フリーモード ${hours}時間${minutes}分${seconds}秒`;
        status.className = 'free-mode-status free';
      } else {
        status.textContent = '問題アップロードで広告フリー';
        status.className = 'free-mode-status ad';
      }
    }
    // フリーモード表示を即座に更新
    updateFreeModeStatus();
    setInterval(updateFreeModeStatus, 1000);
    
    document.addEventListener('DOMContentLoaded', () => {
      // デバッグ用: localStorageをリセット（テスト時のみ使用）
      // localStorage.removeItem('kosamura_last_access');
      
      // アクセスカウントを実行
      kosamuraAPI.incrementAccessCount().then(count => {
        console.log('アクセスカウント更新完了:', count);
      }).catch(error => {
        console.error('アクセスカウント更新エラー:', error);
      });
      
      // 他の初期化処理
    });
  </script>

  <script>
    // share.htmlと同じ共有・コピー・共有ボタンの挙動
    function copyButton(elementId) {
      var element = document.getElementById(elementId);
      navigator.clipboard.writeText(element.value || element.textContent);
      // トースト表示
      var toast = document.getElementById('copyToast');
      toast.style.display = 'block';
      setTimeout(function() { toast.style.opacity = 1; }, 10);
      setTimeout(function() {
        toast.style.opacity = 0;
        setTimeout(function() { toast.style.display = 'none'; }, 400);
      }, 1600);
      // ボタンデザイン変更
      var btn = document.getElementById('copyBtn');
      var originalBg = btn.style.background;
      var originalColor = btn.style.color;
      btn.style.background = '#e0e0e0';
      btn.style.color = '#0071e3';
      btn.innerHTML = '<i class="fa-regular fa-copy"></i> コピーしました！';
      setTimeout(function() {
        btn.style.background = originalBg;
        btn.style.color = originalColor;
        btn.innerHTML = '<i class="fa-regular fa-copy"></i> コピー';
      }, 1400);
    }

    document.addEventListener('DOMContentLoaded', () => {
      const urlInput  = document.getElementById('siteUrl');
      const copyBtn   = document.getElementById('copyBtn');
      const twitterBtn= document.getElementById('twitterBtn');
      const shareBtn  = document.getElementById('nativeShareBtn');
      const toast     = document.getElementById('copyToast');

      // ネイティブ共有
      shareBtn.addEventListener('click', async () => {
        const shareData = {
          title: '秋高考査村',
          text: '無料・匿名で使える過去問共有サイト',
          url: urlInput.value
        };
        if (navigator.share) {
          try {
            await navigator.share(shareData);
          } catch (err) {
            console.error('共有に失敗しました', err);
          }
        } else {
          toast.textContent = 'この端末は共有非対応です。URLをコピーして使ってください';
          toast.style.display = 'block';
          setTimeout(() => { toast.style.opacity = 1; }, 10);
          setTimeout(() => {
            toast.style.opacity = 0;
            setTimeout(() => {
              toast.style.display = 'none';
              toast.textContent = 'コピーしました！';
            }, 400);
          }, 2000);
        }
      });
    });
  </script>
  <script>
    const adminLoginBtn = document.getElementById('adminLoginBtn');
    const adminLoginModal = document.getElementById('adminLoginModal');
    const adminPinInput = document.getElementById('adminPinInput');
    const adminPinError = document.getElementById('adminPinError');
    const adminPinSubmit = document.getElementById('adminPinSubmit');
    const adminPinCancel = document.getElementById('adminPinCancel');
    const adminPinBtns = document.querySelectorAll('.pin-btn');
    const adminUrl = 'admin/admin.html';
    let pinValue = '';
    function openAdminModal() {
      adminLoginModal.style.display = 'flex';
      adminPinInput.value = '';
      pinValue = '';
      adminPinError.textContent = '';
      setTimeout(()=>adminPinInput.focus(), 100);
    }
    function closeAdminModal() {
      adminLoginModal.style.display = 'none';
    }
    adminLoginBtn.onclick = function(e) {
      e.preventDefault();
      openAdminModal();
    };
    adminPinCancel.onclick = function() {
      closeAdminModal();
    };
    adminPinSubmit.onclick = tryAdminLogin;
    adminPinInput.oninput = function(e) {
      pinValue = adminPinInput.value.replace(/\D/g, '').slice(0,4);
      adminPinInput.value = pinValue;
      adminPinError.textContent = '';
    };
    adminPinInput.onkeydown = function(e) {
      if (e.key === 'Enter') tryAdminLogin();
      if (e.key === 'Backspace' && pinValue.length > 0) {
        pinValue = pinValue.slice(0, -1);
        adminPinInput.value = pinValue;
        e.preventDefault();
      }
    };
    adminPinBtns.forEach(btn => {
      btn.onclick = function() {
        if (btn.id === 'pinDelBtn') {
          pinValue = pinValue.slice(0, -1);
        } else if (pinValue.length < 4) {
          pinValue += btn.textContent;
        }
        adminPinInput.value = pinValue;
        adminPinError.textContent = '';
      };
    });

    // Password = 0611
    function tryAdminLogin() {
      if (pinValue === '0611') {
        closeAdminModal();
        window.open(adminUrl, '_blank', 'noopener');
      } else {
        adminPinError.textContent = '番号が違います';
        adminPinInput.value = '';
        pinValue = '';
      }
    }
    // モーダル外クリックで閉じる
    adminLoginModal.onclick = function(e) {
      if (e.target === adminLoginModal) closeAdminModal();
    };
  </script>
  <script>
    // 印刷用テンプレートモーダル機能
    function showPrintTemplateModal() {
      document.getElementById('printTemplateModal').style.display = 'flex';
    }
    
    function closePrintTemplateModal() {
      document.getElementById('printTemplateModal').style.display = 'none';
    }
    
    // モーダル閉じるボタンのイベントリスナー
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('printTemplateClose').addEventListener('click', closePrintTemplateModal);
      
      // モーダル外クリックで閉じる
      document.getElementById('printTemplateModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closePrintTemplateModal();
        }
      });
      
      // ESCキーで閉じる
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closePrintTemplateModal();
        }
      });
    });
  </script>
  <script>
    // 画面幅またはUserAgentでスマホ判定
    function isSmartphone() {
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      // iPhone, Android Mobile, Windows Phone, iPod, Pixel, webOS, BlackBerry, Opera Mini, IEMobile
      // iPadは除外してタブレットではPC版を表示
      return /iPhone|Android.*Mobile|Windows Phone|iPod|Pixel|webOS|BlackBerry|Opera Mini|IEMobile|Mobile/i.test(ua);
    }
    function switchView() {
      if (isSmartphone()) {
        // まず即時にメッセージを表示
        document.getElementById('redirect-message').style.display = '';
        document.getElementById("mock-button").style.display = '';
        document.getElementById('main-content').style.display = 'none';
        // 少し遅延してリダイレクト
        setTimeout(function() {
          if (!location.pathname.endsWith('ph-index.html')) {
            location.href = 'ph-index.html';
          }
        }, 5);
      } else {
        document.getElementById('redirect-message').style.display = 'none';
        document.getElementById("mock-button").style.display = 'none';
        document.getElementById('main-content').style.display = '';
        // PCなら常にPC版を表示
        document.getElementById('pc-view').style.display = '';
        document.getElementById('sp-view').style.display = 'none';
        document.title = '秋高考査村 - ホーム';
      }
    }
    window.addEventListener('DOMContentLoaded', switchView);
    window.addEventListener('resize', switchView);
  </script>
  <script>
    // 統計情報を読み込む関数
    async function loadStats() {
      try {
        console.log('=== loadStats デバッグ開始 ===');
        
        // GASのURLを使用して統計情報を取得
        const gasUrl = 'https://script.google.com/macros/s/AKfycbwEAhdiJOtbf44ifY-BoAFhLI7eQl_uIJKm9NDTexoWZD7U8l-7wsrT9ufRCZ9d8lZf/exec';
        const response = await fetch(`${gasUrl}?function=getStats`);
        console.log('fetch response:', response);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const stats = await response.json();
        console.log('取得した統計データ:', stats);
        
        // レスポンス形式を確認して適切に処理
        let totalPosts, totalLikes, activeUsers;
        
        if (stats.result) {
          // resultプロパティにラップされている場合
          totalPosts = stats.result.totalPosts || 0;
          totalLikes = stats.result.totalLikes || 0;
          activeUsers = stats.result.activeUsers || 0;
        } else {
          // 直接プロパティとして含まれている場合
          totalPosts = stats.totalPosts || 0;
          totalLikes = stats.totalLikes || 0;
          activeUsers = stats.activeUsers || 0;
        }
        
        console.log('処理後の値:');
        console.log('totalPosts:', totalPosts, '(型:', typeof totalPosts, ')');
        console.log('totalLikes:', totalLikes, '(型:', typeof totalLikes, ')');
        console.log('activeUsers:', activeUsers, '(型:', typeof activeUsers, ')');
        
        const totalPostsElement = document.getElementById('totalPosts');
        console.log('totalPostsElement:', totalPostsElement);
        if (totalPostsElement) {
          totalPostsElement.textContent = Number(totalPosts).toLocaleString();
          console.log('totalPostsElement.textContent を設定:', Number(totalPosts).toLocaleString());
        }
        
        const totalLikesElement = document.getElementById('totalLikes');
        console.log('totalLikesElement:', totalLikesElement);
        if (totalLikesElement) {
          totalLikesElement.textContent = Number(totalLikes).toLocaleString();
          console.log('totalLikesElement.textContent を設定:', Number(totalLikes).toLocaleString());
        }
        
        const activeUsersElement = document.getElementById('activeUsers');
        console.log('activeUsersElement:', activeUsersElement);
        if (activeUsersElement) {
          activeUsersElement.textContent = Number(activeUsers).toLocaleString();
          console.log('activeUsersElement.textContent を設定:', Number(activeUsers).toLocaleString());
        }
        
        console.log('=== loadStats デバッグ終了 ===');
      } catch (error) {
        console.error('統計情報の読み込みに失敗しました:', error);
        console.error('エラーの詳細:', error.toString());
        
        // エラー時は0を表示
        const totalPostsElement = document.getElementById('totalPosts');
        const totalLikesElement = document.getElementById('totalLikes');
        const activeUsersElement = document.getElementById('activeUsers');
        
        if (totalPostsElement) totalPostsElement.textContent = '0';
        if (totalLikesElement) totalLikesElement.textContent = '0';
        if (activeUsersElement) activeUsersElement.textContent = '0';
      }
    }
    
    // アクセス数を増加させる関数
    async function incrementAccessCount() {
      try {
        // IPアドレスを取得（簡易的な方法）
        const ipResponse = await fetch('https://api.ipify.org?format=json');
        const ipData = await ipResponse.json();
        const ipAddress = ipData.ip;
        
        // GASのURLを使用してアクセス数を増加
        const gasUrl = 'https://script.google.com/macros/s/AKfycbwEAhdiJOtbf44ifY-BoAFhLI7eQl_uIJKm9NDTexoWZD7U8l-7wsrT9ufRCZ9d8lZf/exec';
        const formData = new FormData();
        formData.append('function', 'incrementAccessCount');
        formData.append('ipAddress', ipAddress);
        formData.append('userAgent', navigator.userAgent);
        
        const response = await fetch(gasUrl, {
          method: 'POST',
          body: formData
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        console.log('アクセス数更新結果:', result);
        
        // レスポンス形式を確認して適切に処理
        if (result.result && result.result.accessCount) {
          console.log('更新後のアクセス数:', result.result.accessCount);
        }
        
        // 統計情報を再読み込み
        loadStats();
        
      } catch (error) {
        console.error('アクセス数の更新に失敗しました:', error);
        console.error('エラーの詳細:', error.toString());
      }
    }
    
    // ページ読み込み時に統計情報を読み込む
    document.addEventListener('DOMContentLoaded', () => {
      loadStats();
      // アクセス数を増加（重複防止はサーバー側で処理）
      incrementAccessCount();
    });
  </script>
  <!-- crack.png ポップアップモーダル -->
<div id="crackModal" style="display:none; position:fixed; z-index:10000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.35); align-items:center; justify-content:center;">
  <div style="background:#fff; border-radius:14px; padding:24px 18px 18px 18px; box-shadow:0 4px 24px rgba(0,0,0,0.18); min-width:220px; max-width:90vw; text-align:center; position:relative;">
    <img src="assets/crack.png" alt="crack" style="max-width:60vw; max-height:60vh; width:auto; height:auto; display:block; margin:0 auto 18px auto;" />
    <button id="crackModalClose" style="background:#0071e3; color:#fff; padding:8px 32px; border:none; border-radius:6px; font-size:1.1em; cursor:pointer;">閉じる</button>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var crackModal = document.getElementById('crackModal');
    var crackModalClose = document.getElementById('crackModalClose');
    if(crackModal && crackModalClose) {
      crackModal.style.display = 'flex';
      crackModalClose.onclick = function() {
        crackModal.style.display = 'none';
      };
      // モーダル外クリックで閉じる
      crackModal.onclick = function(e) {
        if (e.target === crackModal) crackModal.style.display = 'none';
      };
      // ESCキーで閉じる
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') crackModal.style.display = 'none';
      });
    }
  });
</script>
<!-- /crack.png ポップアップモーダル -->
</body>
</html>