<!DOCTYPE html>

<!-- 秋高秋高考査村 -->
<!-- Ver.1.0.0 -->
<!-- 2025/07/31 -->

<!-- Admin Password = 0611 -->

<html lang="ja">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-471J8G71L3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-471J8G71L3');
</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>秋高考査村 - スマホ版</title>
  <link rel="stylesheet" href="assets/css/common.css" />
  <link rel="stylesheet" href="assets/css/pages/ph-index.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="header-title">
        <div class="site-title">秋高考査村</div>
        <div class="site-subtitle">無料・匿名で使える過去問共有サイト</div>
      </div>
      <button class="nav-toggle" id="navToggle" aria-label="メニューを開く" aria-expanded="false" aria-controls="navMenu" aria-haspopup="true">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <nav class="nav-menu" id="navMenu" aria-label="メインナビゲーション">
      <div class="nav-free-mode">
        <div id="freeModeStatus" class="free-mode-status"></div>
      </div>
      <ul class="nav-list">
        <li class="nav-item">
          <a href="ph-index.html" class="nav-link active">
            <i class="fa-solid fa-home"></i> ホーム
          </a>
        </li>
        <li class="nav-item">
          <a href="pages/upload.html" class="nav-link">
            <i class="fa-solid fa-upload"></i> アップロード
          </a>
        </li>
        <li class="nav-item">
          <a href="pages/search.html" class="nav-link">
            <i class="fa-solid fa-database"></i> 問題データベース
          </a>
        </li>
        <li class="nav-item">
          <a href="pages/share.html" class="nav-link">
            <i class="fa-solid fa-share-nodes"></i> 共有・拡散
          </a>
        </li>
        <li class="nav-item">
          <a href="https://c.kuku.lu/hmc853pz" class="nav-link" target="_blank">
            <i class="fa-solid fa-comments"></i> 匿名掲示板
          </a>
        </li>
        <li class="nav-item">
          <a href="https://forms.gle/ZWtQCvecH4eZtTEU7" class="nav-link" target="_blank">
            <i class="fa-solid fa-envelope"></i> 報告・問い合わせ
          </a>
        </li>
      </ul>
    </nav>
  </header>

  
   <main class="main">
     <section class="intro-section">
      <section class="hero">
        <h1 class="hero-title">秋高考査村へようこそ</h1>
        <p class="hero-subtitle">考査問題に限らず、過去問を共有・検索できます</p>
      </section>

      <div class="card main-card">
        <div class="card-content">
          <p class="card-description">
            問題提供で24時間広告なし！
          </p>
          
          <div class="action-buttons">
             <a href="pages/upload.html" class="action-btn primary">
              <i class="fa-solid fa-upload"></i>
              <span>提供</span>
            </a>
             <a href="pages/search.html" class="action-btn secondary">
              <i class="fa-solid fa-database"></i>
              <span>検索</span>
            </a>
            <a href="https://c.kuku.lu/hmc853pz" class="action-btn secondary" target="_blank">
              <i class="fa-solid fa-comments"></i>
              <span>匿名掲示板</span>
            </a>
          </div>

          <ul class="info-list">
            <li class="info-item">
              <div class="info-icon">
                <i class="fa-regular fa-file-pdf"></i>
              </div>
              <div class="info-text">
                PDFまたは写真で投稿
                <span class="info-note">（Word・Excel・一太郎には順次対応）</span>
              </div>
            </li>
            <li class="info-item">
              <div class="info-icon">
                <i class="fa-solid fa-paper-plane"></i>
              </div>
              <div class="info-text">
                ここで投稿していただきたい試験
                <div class="info-highlight margin-top">
                  定期考査・実力テスト・確認テスト など
                </div>
              </div>
            </li>
            <li class="info-item">
              <div class="info-icon">
                <i class="fa-solid fa-comments"></i>
              </div>
              <div class="info-text">
                週間テストや確認プリントなど（小テスト）は<span class="info-highlight">匿名掲示板</span>で！                
              </div>
            </li>
          </ul>
        </div>
      </div>
      <div class="scroll-down-indicator" id="scrollDownIndicator">
        <span class="triangle">▼</span>
      </div>
    </section>

    <section class="stats-section">
      <h2 class="section-title">統計情報</h2>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" id="totalPosts">-</div>
          <div class="stat-label">投稿数</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-number" id="totalLikes">Loading</div>
          <div class="stat-label">いいね数</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-number" id="activeUsers">-</div>
          <div class="stat-label">訪問者数</div>
        </div>
      </div>
    </section>

    <div class="card notice">
      <div class="card-content">
        <h2 class="card-title zoom-75">皆様にお伝えしたいことがあります</h2>
        <div class="video-container full-width">
          <video controls style="width: 100%; background: #000;">
            <source src="assets/考査村ビデオ.mp4" type="video/mp4">
            お使いのブラウザは動画再生に対応していません。
          </video>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-content">
        <h2 class="card-title">更新履歴</h2>
        <ul class="history-list">
          <li class="history-item"><span class="history-date">2025/08/05</span><span class="history-desc">サーバー移行 新システムでの運用開始</span></li>
          <li class="history-item"><span class="history-date">2025/06/12</span><span class="history-desc">PDF結合ロジック修正</span></li>
          <li class="history-item"><span class="history-date">2024/07/21</span><span class="history-desc">評価システム導入</span></li>
          <li class="history-item"><span class="history-date">2024/07/20</span><span class="history-desc">匿名掲示板オープン　詳細については、下を御覧ください。</span></li>
          <li class="history-item"><span class="history-date">2024/06/26</span><span class="history-desc">サービス開始</span></li>
        </ul>
      </div>
    </div>

    <div class="bbs card card-inview">
      <div class="card-content">
        <h2 class="card-title">匿名匿名掲示板（外部サービス使用）</h2>
        <div class="indent left-align">
          これら匿名掲示板では、主に次のような情報を共有することを目的として用意しました。<br>
          完全匿名ですぐに利用できます。<br><br>
          
          <strong class="info-highlight">★平均点の報告</strong><br>
          　クラス平均点100点を目指そう！<br><br>
          
          <strong class="info-highlight">★テストの共有（写真投稿機能あり）</strong><br><br>
          <strong class="info-highlight">★過去問と一致している科目の報告</strong><br><br>
          <strong class="info-highlight">★試験への対策について。</strong><br><br><br>
          
          <strong class="info-highlight">掲示板リンク</strong><br>
          <div class="button-container">
            <button class="bbs-btn" onclick="window.open('https://c.kuku.lu/hmc853pz', '_blank')">
              <i class="fa-solid fa-comments"></i>
              <span>全体の部屋</span>
            </button>
            <button class="bbs-btn" onclick="window.open('https://c.kuku.lu/wxamr3rk', '_blank')">
              <i class="fa-solid fa-users"></i>
              <span>３年生の部屋</span>
            </button>
            <button class="bbs-btn" onclick="window.open('https://c.kuku.lu/shwzzu7z', '_blank')">
              <i class="fa-solid fa-users"></i>
              <span>２年生の部屋</span>
            </button>
            <button class="bbs-btn" onclick="window.open('https://c.kuku.lu/xpgpbn7k', '_blank')">
              <i class="fa-solid fa-users"></i>
              <span>１年生の部屋</span>
            </button>
            <button class="bbs-btn" onclick="window.open('https://c.kuku.lu/rk6hxege', '_blank')">
              <i class="fa-solid fa-user-tie"></i>
              <span>運営者と話す部屋</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="card about card-inview">
      <div class="card-content">
        <h2 class="card-title">このサービスについて</h2>
        <div class="indent justify">
          私が1年生で受けた「歴史総合」の考査を前年の問題と比較したところ、年度の数字が一つ増えただけでした。さらに、2年生で受けた「公共」の試験問題は、過去問と一致している部分が8割を超えていました。評定に関わる考査で、いくら授業が同じ内容だとはいえ前年の問題をほとんど同じく出題すべきではないと考えます。入試に関わらない教科であっても、過去問を手に入れることで勉強時間を他の重要な科目に充てることができます。<br><br>
          
          このサービスは、先輩とのつながりがない人でも過去問を利用できることを目指し、平均点を異常に高くし、将来的にコピペしただけの考査問題を絶滅させることを目的としたプロジェクトです。<br><br>
          
          このサービスは個人で運営しています。サービス維持には皆さんのご協力が必要です。ぜひ、過去問のアップロードやこのサイトの共有・拡散をよろしくお願いします。<br>
        </div>
      </div>
    </div>

    <div class="card card-inview">
      <div class="card-content">
        <h2 class="card-title">共有・拡散</h2>
        <p class="text-center margin-bottom">
          秋高考査村を友達やクラス、学校に広めて<br>みんなで過去問を共有しよう
        </p>
      
        <div class="sharecontents">
          <input 
            type="text" 
            id="siteUrl" 
            class="share-input" 
            value="https://akt-kosamura.github.io/kosamura/" 
            readonly
          >
          
          <div class="copy-button-container">
            <button class="action-btn secondary rounded" id="copyBtn" onclick="copyButton('siteUrl')">
              <i class="fa-regular fa-copy"></i>
              <span>コピー</span>
            </button>
          </div>
          
          <div class="share-buttons">
            <a
              id="twitterBtn"
              href="https://twitter.com/intent/tweet?text=無料＆匿名で使える過去問共有サイト「秋高考査村」%0A考査問題に限らず、テスト問題をアップロード・閲覧できるサービスです。%0A%0Ahttps://akt-kosamura.github.io/kosamura/%0A%0A%23考査村%20%23過去問"
              class="share-btn"
              target="_blank" 
              rel="noopener noreferrer"
            >
              <i class="fa-brands fa-twitter fa-twitter"></i>
              <span>ツイート</span>
            </a>
            <button class="share-btn" id="nativeShareBtn">
              <i class="fa-solid fa-share-nodes fa-share-nodes"></i>
              <span>共有</span>
            </button>
          </div>
          
          <button class="print-btn" onclick="showPrintTemplateModal()">
            <i class="fa-solid fa-print fa-print"></i> 印刷用テンプレート
          </button>
          
          <br>
          
          <div class="divider-container">
            <a href="https://forms.gle/ZWtQCvecH4eZtTEU7" class="action-btn secondary rounded" target="_blank">
              <i class="fa-solid fa-envelope fa-envelope"></i>
              <span>問い合わせフォーム</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </main>
     <div class="admin-login-container">
       <a href="#" id="adminLoginBtn" class="admin-login-btn">
         <i class="fa-solid fa-user-shield"></i>管理画面へ
      </a>
    </div>
     <div id="adminLoginModal" class="admin-modal">
       <div class="admin-modal-content">
         <div class="admin-modal-title">暗証番号</div>
         <input id="adminPinInput" type="password" inputmode="numeric" maxlength="4" pattern="[0-9]*" class="admin-pin-input" autocomplete="one-time-code" />
         <div id="adminPinError" class="admin-pin-error"></div>
         <div class="pin-grid">
          <button class="pin-btn">1</button><button class="pin-btn">2</button><button class="pin-btn">3</button>
          <button class="pin-btn">4</button><button class="pin-btn">5</button><button class="pin-btn">6</button>
          <button class="pin-btn">7</button><button class="pin-btn">8</button><button class="pin-btn">9</button>
          <div></div><button class="pin-btn">0</button><button class="pin-btn" id="pinDelBtn">⌫</button>
        </div>
         <button id="adminPinSubmit" class="admin-pin-submit">OK</button>
         <button id="adminPinCancel" class="admin-pin-cancel">キャンセル</button>
      </div>
    </div>

  <div class="copyright-note">Copyright© 2024 考査村 All Rights Reserved.</div><br>

     <div id="copyToast" class="toast">コピーしました！</div>
   
    <!-- 印刷用テンプレートモーダル -->
    <div id="printTemplateModal" class="print-modal">
      <div class="print-modal-content">
        <div class="print-modal-title">印刷用テンプレート</div>
        <div class="print-modal-body">
          <p class="print-modal-description" style="text-align: center;">選択してダウンロード</p>
          <div class="print-modal-links">
            <a href="assets/documents/ミニカード.pdf" download class="print-modal-link">
              <i class="fa-regular fa-file-pdf"></i>
              <span>1. ミニカード (.pdf)</span>
            </a>
            <a href="assets/documents/短冊.pdf" download class="print-modal-link">
              <i class="fa-regular fa-file-pdf"></i>
              <span>2. 短冊型PDF (.pdf)</span>
            </a>
            <a href="assets/documents/宣伝用.jtd" download class="print-modal-link">
              <img src="assets/jtd_icon.gif" alt="一太郎アイコン" class="jtd-icon">
              <span>3. 元ファイル (.jtd)　 ※複数シート</span>
            </a>
          </div>
        </div>
        <button id="printTemplateClose" class="print-modal-close">閉じる</button>
      </div>
    </div>
   
    <div id="noticePopup">
     <div class="popup-content">
       <button onclick="closeNoticePopup()" class="popup-close-btn">
         <i class="fa-solid fa-times"></i>
       </button>
       
       <div class="popup-inner">
         <h2 class="popup-title">ごめんなさい</h2>
         <p class="popup-text">
            現在「ホーム」ページのみスマホに最適化されています。「アップロード」及び「問題検索」画面では文字が小さなパソコン版が表示されます。ご了承ください。
          </p>
          
          <div class="popup-checkbox-container">
            <label class="popup-checkbox-label">
              <input type="checkbox" id="hideNoticePopup">
              <span>次回から非表示</span>
            </label>
          </div>
          
          <button onclick="closeNoticePopup()" class="popup-close-button">
            閉じる
          </button>
       </div>
     </div>
   </div>

   <!-- crack.png ポップアップモーダル -->
   <div id="crackModal" style="display:none; position:fixed; z-index:10000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.35); align-items:center; justify-content:center;">
     <div style="background:#fff; border-radius:14px; padding:24px 18px 18px 18px; box-shadow:0 4px 24px rgba(0,0,0,0.18); min-width:220px; max-width:90vw; text-align:center; position:relative;">
       <img src="assets/crack.png" alt="crack" style="max-width:60vw; max-height:60vh; width:auto; height:auto; display:block; margin:0 auto 18px auto;" />
       <button id="crackModalClose" style="background:#0071e3; color:#fff; padding:8px 32px; border:none; border-radius:6px; font-size:1.1em; cursor:pointer;">閉じる</button>
     </div>
   </div>

     <!-- Font Awesomeは既にCSSで読み込み済みのため削除 -->
      <script src="assets/js/api.js"></script>
   

  <script>
    document.title = '秋高考査村 - スマホ版';
    
    // ページ読み込み時に最上部にスクロール
    window.addEventListener('load', function() {
      window.scrollTo(0, 0);
      
      // ヘッダーを確実に表示（ページ読み込み完了時）
      const header = document.querySelector('.header');
      if (header) {
        header.style.opacity = '1';
        header.style.visibility = 'visible';
        header.style.display = 'block';
      }
    });
    
    // DOMContentLoadedでも念のため実行
    document.addEventListener('DOMContentLoaded', function() {
      window.scrollTo(0, 0);
      
      // ヘッダーを確実に表示
      const header = document.querySelector('.header');
      if (header) {
        header.style.opacity = '1';
        header.style.visibility = 'visible';
        header.style.display = 'block';
      }
    });
  </script>
  <script>
        let popupShown = false;
        
        window.addEventListener('load', function() {
          if (!popupShown) {
            showNoticePopup();
            popupShown = true;
          }
        });
       
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(function() {
            if (!popupShown) {
              showNoticePopup();
              popupShown = true;
            }
          }, 100);
        });
    
      function showNoticePopup() {
        if (localStorage.getItem('hideNoticePopup') === 'true') {
          console.log('ポップアップは非表示設定のため表示しません');
          // 「ごめんなさい」ポップアップが非表示の場合でも、crack.pngポップアップは表示
          setTimeout(() => {
            showCrackModal();
          }, 100);
          return;
        }
        
        const popup = document.getElementById('noticePopup');
        if (popup && popup.style.display === 'flex') {
          console.log('ポップアップは既に表示されているため表示しません');
          return;
        }
        
        const fontAwesomeLoaded = document.querySelector('link[href*="font-awesome"]') && 
                                 document.querySelector('link[href*="font-awesome"]').sheet;
        const cssLoaded = document.querySelector('link[href*="ph-index.css"]') && 
                         document.querySelector('link[href*="ph-index.css"]').sheet;
        
        if (!fontAwesomeLoaded || !cssLoaded) {
          setTimeout(showNoticePopup, 50);
          return;
        }
        
        if (popup) {
          setTimeout(() => {
            popup.style.display = 'flex';
            setTimeout(() => {
              popup.style.opacity = '1';
            }, 20);
            document.body.style.overflow = 'hidden';
            console.log('ポップアップを表示しました');
          }, 10);
        }
      }
    
     function closeNoticePopup() {
       const popup = document.getElementById('noticePopup');
       const checkbox = document.getElementById('hideNoticePopup');
       
       if (popup) {
         popup.style.opacity = '0';
         setTimeout(() => {
           popup.style.display = 'none';
           document.body.style.overflow = '';
           
           // 「ごめんなさい」ポップアップが閉じられた後にcrack.pngポップアップを表示
           setTimeout(() => {
             showCrackModal();
           }, 300);
         }, 200);
         
         if (checkbox && checkbox.checked) {
           localStorage.setItem('hideNoticePopup', 'true');
           console.log('次回から非表示設定を保存しました');
         } else {
           console.log('チェックボックスがチェックされていないため、次回も表示されます');
         }
       }
     }
     
     function showCrackModal() {
       const crackModal = document.getElementById('crackModal');
       const crackModalClose = document.getElementById('crackModalClose');
       
       if (crackModal && crackModalClose) {
         crackModal.style.display = 'flex';
         crackModalClose.onclick = function() {
           crackModal.style.display = 'none';
         };
         
         // モーダル外クリックで閉じる
         crackModal.onclick = function(e) {
           if (e.target === crackModal) crackModal.style.display = 'none';
         };
         
         // ESCキーで閉じる
         document.addEventListener('keydown', function(e) {
           if (e.key === 'Escape') crackModal.style.display = 'none';
         });
       }
     }
    
    const navToggle = document.getElementById('navToggle');
    const navMenu = document.getElementById('navMenu');
    let isMenuOpen = false;

    navToggle.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      
      isMenuOpen = !isMenuOpen;
      navToggle.classList.toggle('active');
      navMenu.classList.toggle('active');
      
      // ARIA属性を適切な真偽値で設定
      navToggle.setAttribute('aria-expanded', isMenuOpen);
      navToggle.setAttribute('aria-label', isMenuOpen ? 'メニューを閉じる' : 'メニューを開く');
      
      if (navigator.vibrate) {
        navigator.vibrate(50);
      }
      const header = document.querySelector('.header');
      if (isMenuOpen) {
        document.body.style.overflow = 'hidden';
        if (header) header.style.position = 'fixed';
      } else {
        document.body.style.overflow = '';
        if (header) header.style.position = '';
      }
    });

    document.addEventListener('click', (e) => {
      if (isMenuOpen && !navToggle.contains(e.target) && !navMenu.contains(e.target)) {
        navToggle.classList.remove('active');
        navMenu.classList.remove('active');
        isMenuOpen = false;
        // ARIA属性を適切に設定
        navToggle.setAttribute('aria-expanded', false);
        navToggle.setAttribute('aria-label', 'メニューを開く');
        document.body.style.overflow = '';
        const header = document.querySelector('.header');
        if (header) header.style.position = '';
      }
    });

    navMenu.addEventListener('click', (e) => {
      e.stopPropagation();
    });

    navMenu.addEventListener('click', (e) => {
      if (e.target.tagName === 'A' || e.target.closest('a')) {
        setTimeout(() => {
          navToggle.classList.remove('active');
          navMenu.classList.remove('active');
          isMenuOpen = false;
          // ARIA属性を適切に設定
          navToggle.setAttribute('aria-expanded', false);
          navToggle.setAttribute('aria-label', 'メニューを開く');
          document.body.style.overflow = '';
          const header = document.querySelector('.header');
          if (header) header.style.position = '';
        }, 100);
      }
    });

    function copyButton(elementId) {
      const element = document.getElementById(elementId);
      const text = element.value || element.textContent;
      
      navigator.clipboard.writeText(text).then(() => {
        showToast('コピーしました！');
        
        const btn = document.getElementById('copyBtn');
        const originalContent = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-check"></i><span>コピー完了</span>';
        btn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
        btn.style.color = 'white';
        btn.style.border = '2px solid #10b981';
        btn.style.transform = 'scale(1.05)';
        
        if (navigator.vibrate) {
          navigator.vibrate([50, 50, 50]);
        }
        
        setTimeout(() => {
          btn.innerHTML = originalContent;
          btn.style.background = '';
          btn.style.color = '';
          btn.style.border = '';
          btn.style.transform = '';
        }, 2000);
      }).catch(() => {
        showToast('コピーに失敗しました');
      });
    }

    function showToast(message) {
      const toast = document.getElementById('copyToast');
      toast.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 2500);
    }

    document.addEventListener('DOMContentLoaded', () => {
      const urlInput = document.getElementById('siteUrl');
      const shareBtn = document.getElementById('nativeShareBtn');

      shareBtn.addEventListener('click', async () => {
        const shareData = {
          title: '秋高考査村',
          text: '無料・匿名で使える過去問共有サイト',
          url: urlInput.value
        };

        if (navigator.share) {
          try {
            await navigator.share(shareData);
            showToast('共有しました！');
          } catch (err) {
            if (err.name !== 'AbortError') {
              console.error('共有に失敗しました', err);
              showToast('共有に失敗しました');
            }
          }
        } else {
          showToast('この端末は共有非対応です。URLをコピーして使ってください');
        }
      });
    });

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

     let lastScrollTop = 0;
     const header = document.querySelector('.header');
     let ticking = false;
 
     function updateHeader() {
       const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
       
       const isScrollingDown = scrollTop > lastScrollTop;
       const shouldHide = isScrollingDown && scrollTop > 100;
       
       const newTransform = shouldHide ? 'translateY(-100%)' : 'translateY(0)';
       const newOpacity = shouldHide ? '0.95' : '1';
       const newBlur = scrollTop > 50 ? 'blur(25px)' : 'blur(20px)';
       
       if (header.style.transform !== newTransform) {
         header.style.transform = newTransform;
         header.style.opacity = newOpacity;
       }
       
       if (header.style.backdropFilter !== newBlur) {
         header.style.backdropFilter = newBlur;
         header.style.webkitBackdropFilter = newBlur;
       }
       
       lastScrollTop = scrollTop;
       ticking = false;
     }
 
     window.addEventListener('scroll', throttle(() => {
       if (!ticking) {
         requestAnimationFrame(updateHeader);
         ticking = true;
       }
     }, 16));

     window.addEventListener('scroll', throttle(() => {
       const indicator = document.getElementById('scrollDownIndicator');
       if (!indicator) return;
       
       const scrollPercent = window.scrollY / (window.innerHeight * 0.3);
       const opacity = Math.max(0, 0.8 - scrollPercent);
       
       if (indicator.style.opacity !== opacity.toString()) {
         indicator.style.opacity = opacity;
         indicator.style.transform = `translateX(-50%) translateY(${scrollPercent * 10}px)`;
         indicator.style.pointerEvents = opacity > 0.1 ? 'auto' : 'none';
       }
     }, 32));

     document.addEventListener('DOMContentLoaded', function() {
       const cards = document.querySelectorAll('.card');
       
       const observer = new IntersectionObserver((entries, obs) => {
         entries.forEach((entry, index) => {
           if (entry.isIntersecting) {
             const delay = entry.target.classList.contains('bbs') ? 0 : index * 50;
             setTimeout(() => {
               entry.target.classList.add('card-inview');
             }, delay);
             obs.unobserve(entry.target);
           }
         });
       }, { 
         threshold: 0.1, 
         rootMargin: '0px 0px -30px 0px' 
       });
       
       cards.forEach(card => {
         observer.observe(card);
       });
     });

     document.addEventListener('DOMContentLoaded', function() {
       const interactiveElements = document.querySelectorAll('.action-btn, .share-btn, .print-btn, .nav-link');
       
       document.addEventListener('touchstart', function(e) {
         const target = e.target.closest('.action-btn, .share-btn, .print-btn, .nav-link');
         if (target) {
           target.style.transform = 'scale(0.98)';
         }
       }, { passive: true });
       
       document.addEventListener('touchend', function(e) {
         const target = e.target.closest('.action-btn, .share-btn, .print-btn, .nav-link');
         if (target) {
           setTimeout(() => {
             target.style.transform = '';
           }, 150);
         }
       }, { passive: true });
     });

     window.addEventListener('resize', debounce(() => {
       const vh = window.innerHeight * 0.01;
       document.documentElement.style.setProperty('--vh', `${vh}px`);
     }, 250));
 
     const vh = window.innerHeight * 0.01;
     document.documentElement.style.setProperty('--vh', `${vh}px`);
    
     function debounce(func, wait) {
       let timeout;
       return function executedFunction(...args) {
         const later = () => {
           clearTimeout(timeout);
           func(...args);
         };
         clearTimeout(timeout);
         timeout = setTimeout(later, wait);
       };
     }
     
     function throttle(func, limit) {
       let inThrottle;
       return function() {
         const args = arguments;
         const context = this;
         if (!inThrottle) {
           func.apply(context, args);
           inThrottle = true;
           setTimeout(() => inThrottle = false, limit);
         }
       }
     }

    function isInFreeMode() {
      const freeModeEnd = localStorage.getItem('freeModeEnd');
      if (!freeModeEnd) return false;
      return new Date().getTime() < parseInt(freeModeEnd);
    }
    function updateFreeModeStatus() {
      const status = document.getElementById('freeModeStatus');
      if (!status) return;
      if (isInFreeMode()) {
        const freeModeEnd = parseInt(localStorage.getItem('freeModeEnd'));
        const remaining = freeModeEnd - new Date().getTime();
        if (remaining <= 0) {
          localStorage.removeItem('freeModeEnd');
          status.textContent = '問題アップロードで広告フリー';
          status.className = 'free-mode-status ad';
          return;
        }
        const hours = Math.floor(remaining / (60 * 60 * 1000));
        const minutes = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000));
        const seconds = Math.floor((remaining % (60 * 1000)) / 1000);
        status.textContent = `フリーモード ${hours}時間${minutes}分${seconds}秒`;
        status.className = 'free-mode-status free';
      } else {
        status.textContent = '問題アップロードで広告フリー';
        status.className = 'free-mode-status ad';
      }
    }
     updateFreeModeStatus();
     setInterval(updateFreeModeStatus, 1000);
     
     document.addEventListener('click', (e) => {
       const popup = document.getElementById('noticePopup');
       if (popup && e.target === popup) {
         closeNoticePopup();
       }
     });
    
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          const popup = document.getElementById('noticePopup');
          if (popup && popup.style.display === 'flex') {
            closeNoticePopup();
          }
        }
        if (e.ctrlKey && e.key === 'r') {
          localStorage.removeItem('hideNoticePopup');
          console.log('ローカルストレージをリセットしました。次回ポップアップが表示されます。');
        }
      });
    
    document.addEventListener('DOMContentLoaded', () => {
      loadStats();
      
      // 印刷用テンプレートモーダルのイベントリスナー
      const printTemplateClose = document.getElementById('printTemplateClose');
      const printTemplateModal = document.getElementById('printTemplateModal');
      
      if (printTemplateClose) {
        printTemplateClose.addEventListener('click', closePrintTemplateModal);
      }
      
      if (printTemplateModal) {
        printTemplateModal.addEventListener('click', function(e) {
          if (e.target === this) {
            closePrintTemplateModal();
          }
        });
      }
      
      // ESCキーでモーダルを閉じる
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closePrintTemplateModal();
        }
      });
    });
    
    // 印刷用テンプレートモーダル機能
    function showPrintTemplateModal() {
      const modal = document.getElementById('printTemplateModal');
      if (modal) {
        modal.style.display = 'flex';
        setTimeout(() => {
          modal.style.opacity = '1';
        }, 10);
        document.body.style.overflow = 'hidden';
      }
    }
    
    function closePrintTemplateModal() {
      const modal = document.getElementById('printTemplateModal');
      if (modal) {
        modal.style.opacity = '0';
        setTimeout(() => {
          modal.style.display = 'none';
          document.body.style.overflow = '';
        }, 200);
      }
    }
    
    async function loadStats() {
      try {
        console.log('=== loadStats デバッグ開始 ===');
        
        // GASのURLを使用して統計情報を取得
        const gasUrl = 'https://script.google.com/macros/s/AKfycbwEAhdiJOtbf44ifY-BoAFhLI7eQl_uIJKm9NDTexoWZD7U8l-7wsrT9ufRCZ9d8lZf/exec';
        const response = await fetch(`${gasUrl}?function=getStats`);
        console.log('fetch response:', response);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const stats = await response.json();
        console.log('取得した統計データ:', stats);
        
        // レスポンス形式を確認して適切に処理
        let totalPosts, totalLikes, activeUsers;
        
        if (stats.result) {
          // resultプロパティにラップされている場合
          totalPosts = stats.result.totalPosts || 0;
          totalLikes = stats.result.totalLikes || 0;
          activeUsers = stats.result.activeUsers || 0;
        } else {
          // 直接プロパティとして含まれている場合
          totalPosts = stats.totalPosts || 0;
          totalLikes = stats.totalLikes || 0;
          activeUsers = stats.activeUsers || 0;
        }
        
        console.log('処理後の値:');
        console.log('totalPosts:', totalPosts, '(型:', typeof totalPosts, ')');
        console.log('totalLikes:', totalLikes, '(型:', typeof totalLikes, ')');
        console.log('activeUsers:', activeUsers, '(型:', typeof activeUsers, ')');
        
        const totalPostsElement = document.getElementById('totalPosts');
        console.log('totalPostsElement:', totalPostsElement);
        if (totalPostsElement) {
          totalPostsElement.textContent = Number(totalPosts).toLocaleString();
          console.log('totalPostsElement.textContent を設定:', Number(totalPosts).toLocaleString());
        }
        
        const totalLikesElement = document.getElementById('totalLikes');
        console.log('totalLikesElement:', totalLikesElement);
        if (totalLikesElement) {
          totalLikesElement.textContent = Number(totalLikes).toLocaleString();
          console.log('totalLikesElement.textContent を設定:', Number(totalLikes).toLocaleString());
        }
        
        const activeUsersElement = document.getElementById('activeUsers');
        console.log('activeUsersElement:', activeUsersElement);
        if (activeUsersElement) {
          activeUsersElement.textContent = Number(activeUsers).toLocaleString();
          console.log('activeUsersElement.textContent を設定:', Number(activeUsers).toLocaleString());
        }
        
        console.log('=== loadStats デバッグ終了 ===');
      } catch (error) {
        console.error('統計情報の読み込みに失敗しました:', error);
        console.error('エラーの詳細:', error.toString());
        
        // エラー時は0を表示
        const totalPostsElement = document.getElementById('totalPosts');
        const totalLikesElement = document.getElementById('totalLikes');
        const activeUsersElement = document.getElementById('activeUsers');
        
        if (totalPostsElement) totalPostsElement.textContent = '0';
        if (totalLikesElement) totalLikesElement.textContent = '0';
        if (activeUsersElement) activeUsersElement.textContent = '0';
      }
    }
    
    // アクセス数を増加させる関数
    async function incrementAccessCount() {
      try {
        // localStorageで3時間制限をチェック
        const lastAccessKey = 'kosamura_last_access';
        const now = Date.now();
        const threeHoursInMs = 3 * 60 * 60 * 1000; // 3時間をミリ秒で
        
        const lastAccess = localStorage.getItem(lastAccessKey);
        if (lastAccess) {
          const timeDiff = now - parseInt(lastAccess);
          if (timeDiff < threeHoursInMs) {
            console.log('3時間以内にアクセス済みです。カウントを増加しません。');
            return; // 3時間以内の場合は増加しない
          }
        }
        
        // IPアドレスを取得（簡易的な方法）
        const ipResponse = await fetch('https://api.ipify.org?format=json');
        const ipData = await ipResponse.json();
        const ipAddress = ipData.ip;
        
        // GASのURLを使用してアクセス数を増加
        const gasUrl = 'https://script.google.com/macros/s/AKfycbwEAhdiJOtbf44ifY-BoAFhLI7eQl_uIJKm9NDTexoWZD7U8l-7wsrT9ufRCZ9d8lZf/exec';
        const formData = new FormData();
        formData.append('function', 'incrementAccessCount');
        formData.append('ipAddress', ipAddress);
        formData.append('userAgent', navigator.userAgent);
        formData.append('clientTimestamp', now.toString());
        
        const response = await fetch(gasUrl, {
          method: 'POST',
          body: formData
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        console.log('アクセス数更新結果:', result);
        
        // レスポンス形式を確認して適切に処理
        let accessCount;
        if (result.result && result.result.accessCount !== undefined) {
          accessCount = result.result.accessCount;
        } else if (result.accessCount !== undefined) {
          accessCount = result.accessCount;
        } else {
          console.error('アクセス数がレスポンスに含まれていません:', result);
          accessCount = 0;
        }
        
        // 成功した場合、localStorageにアクセス時刻を記録
        if (accessCount > 0) {
          localStorage.setItem(lastAccessKey, now.toString());
          console.log('アクセス数を更新しました。3時間後に再カウント可能になります。');
        }
        
        // 統計情報を再読み込み
        loadStats();
        
      } catch (error) {
        console.error('アクセス数の更新に失敗しました:', error);
      }
    }
    
    // ページ読み込み時にアクセス数を増加
    document.addEventListener('DOMContentLoaded', () => {
      incrementAccessCount();
    });
  </script>
  <script>
    const adminLoginBtn = document.getElementById('adminLoginBtn');
    const adminLoginModal = document.getElementById('adminLoginModal');
    const adminPinInput = document.getElementById('adminPinInput');
    const adminPinError = document.getElementById('adminPinError');
    const adminPinSubmit = document.getElementById('adminPinSubmit');
    const adminPinCancel = document.getElementById('adminPinCancel');
    const adminPinBtns = document.querySelectorAll('.pin-btn');
     
    let pinValue = '';
    function openAdminModal() {
      adminLoginModal.style.display = 'flex';
      adminPinInput.value = '';
      pinValue = '';
      adminPinError.textContent = '';
    }
    function closeAdminModal() {
      adminLoginModal.style.display = 'none';
    }
    adminLoginBtn.onclick = function(e) {
      e.preventDefault();
      openAdminModal();
    };
    adminPinCancel.onclick = function() {
      closeAdminModal();
    };
    adminPinSubmit.onclick = tryAdminLogin;
    adminPinInput.oninput = function(e) {
      pinValue = adminPinInput.value.replace(/\D/g, '').slice(0,4);
      adminPinInput.value = pinValue;
      adminPinError.textContent = '';
    };
    adminPinInput.onkeydown = function(e) {
      if (e.key === 'Enter') tryAdminLogin();
      if (e.key === 'Backspace' && pinValue.length > 0) {
        pinValue = pinValue.slice(0, -1);
        adminPinInput.value = pinValue;
        e.preventDefault();
      }
    };
    adminPinBtns.forEach(btn => {
      btn.onclick = function() {
        if (btn.id === 'pinDelBtn') {
          pinValue = pinValue.slice(0, -1);
        } else if (pinValue.length < 4) {
          pinValue += btn.textContent;
        }
        adminPinInput.value = pinValue;
        adminPinError.textContent = '';
      };
    });
    function tryAdminLogin() {
      if (pinValue === '0611') {
        closeAdminModal();
         window.open('admin/admin.html', '_blank', 'noopener');
      } else {
        adminPinError.textContent = '正しくありません';
        adminPinInput.value = '';
        pinValue = '';
      }
    }
    adminLoginModal.onclick = function(e) {
      if (e.target === adminLoginModal) closeAdminModal();
    };
  </script>
</body>
</html>