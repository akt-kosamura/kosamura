<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>秋高考査村 - Aqua</title>
  <meta name="description" content="無料・完全匿名で使える過去問共有サイトです。考査以外の問題も共有できます。情報交換のための掲示板も用意してあります。">
  <link rel="stylesheet" href="aqua.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="icon" href="assets/icon.png">
</head>
<body>
  <!-- 雫の背景アニメーション -->
  <div class="droplets-container">
    <div class="droplet droplet-1"></div>
    <div class="droplet droplet-2"></div>
    <div class="droplet droplet-3"></div>
    <div class="droplet droplet-4"></div>
    <div class="droplet droplet-5"></div>
    <div class="droplet droplet-6"></div>
    <div class="droplet droplet-7"></div>
    <div class="droplet droplet-8"></div>
  </div>

  <header class="aqua-header">
    <div class="header-content">
      <div class="header-title">
        <div class="site-title">秋高考査村</div>
        <div class="site-subtitle">無料・匿名で使える過去問共有サイト</div>
      </div>
      <button class="nav-toggle" id="navToggle" aria-label="メニューを開く">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <nav class="nav-menu" id="navMenu">
      <div class="nav-free-mode">
        <div id="freeModeStatus" class="free-mode-status"></div>
      </div>
      <ul class="nav-list">
        <li class="nav-item">
          <a href="ph-index.html" class="nav-link active">
            <i class="fa-solid fa-home"></i> ホーム
          </a>
        </li>
        <li class="nav-item">
          <a href="pages/upload.html" class="nav-link">
            <i class="fa-solid fa-upload"></i> アップロード
          </a>
        </li>
        <li class="nav-item">
          <a href="pages/search.html" class="nav-link">
            <i class="fa-solid fa-database"></i> 問題データベース
          </a>
        </li>
        <li class="nav-item">
          <a href="pages/share.html" class="nav-link">
            <i class="fa-solid fa-share-nodes"></i> 共有・拡散
          </a>
        </li>
        <li class="nav-item">
          <a href="https://c.kuku.lu/hmc853pz" class="nav-link" target="_blank">
            <i class="fa-solid fa-comments"></i> 匿名掲示板
          </a>
        </li>
        <li class="nav-item">
          <a href="https://forms.gle/ZWtQCvecH4eZtTEU7" class="nav-link" target="_blank">
            <i class="fa-solid fa-envelope"></i> 報告・問い合わせ
          </a>
        </li>
      </ul>
    </nav>
  </header>

  <main class="aqua-main">
    <section class="hero-section">
      <div class="hero-content">
        <h1 class="hero-title">秋高考査村へようこそ</h1>
        <p class="hero-subtitle">考査問題に限らず、過去問を共有・検索できます</p>
        <div class="hero-droplet"></div>
      </div>
    </section>

    <section class="main-content">
      <div class="aqua-card main-card">
        <div class="card-content">
          <p class="card-description">
            問題提供で24時間広告なし！
          </p>
          
          <div class="action-buttons">
            <a href="pages/upload.html" class="aqua-btn primary">
              <i class="fa-solid fa-upload"></i>
              <span>提供</span>
            </a>
            <a href="pages/search.html" class="aqua-btn secondary">
              <i class="fa-solid fa-database"></i>
              <span>検索</span>
            </a>
            <a href="https://c.kuku.lu/hmc853pz" class="aqua-btn secondary" target="_blank">
              <i class="fa-solid fa-comments"></i>
              <span>匿名掲示板</span>
            </a>
          </div>

          <ul class="info-list">
            <li class="info-item">
              <div class="info-icon">
                <i class="fa-regular fa-file-pdf"></i>
              </div>
              <div class="info-text">
                PDFまたは写真で投稿
                <span class="info-note">（Word・Excel・一太郎には順次対応）</span>
              </div>
            </li>
            <li class="info-item">
              <div class="info-icon">
                <i class="fa-solid fa-paper-plane"></i>
              </div>
              <div class="info-text">
                ここで投稿していただきたい試験
                <div class="info-highlight margin-top">
                  定期考査・実力テスト・確認テスト など
                </div>
              </div>
            </li>
            <li class="info-item">
              <div class="info-icon">
                <i class="fa-solid fa-comments"></i>
              </div>
              <div class="info-text">
                週間テストや確認プリントなど（小テスト）は<span class="info-highlight">匿名掲示板</span>で！                
              </div>
            </li>
          </ul>
        </div>
      </div>

      <div class="aqua-card stats-card">
        <h2 class="card-title">統計情報</h2>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-number" id="totalPosts">-</div>
            <div class="stat-label">投稿数</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="totalLikes">Loading</div>
            <div class="stat-label">いいね数</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="activeUsers">-</div>
            <div class="stat-label">訪問者数</div>
          </div>
        </div>
      </div>

      <div class="aqua-card notice-card">
        <div class="card-content">
          <h2 class="card-title">皆様にお伝えしたいことがあります</h2>
          <div class="video-container">
            <video controls>
              <source src="assets/考査村ビデオ.mp4" type="video/mp4">
              お使いのブラウザは動画再生に対応していません。
            </video>
          </div>
        </div>
      </div>

      <div class="aqua-card">
        <div class="card-content">
          <h2 class="card-title">更新履歴</h2>
          <ul class="history-list">
            <li class="history-item"><span class="history-date">2025/08/05</span><span class="history-desc">サーバー移行 新システムでの運用開始</span></li>
            <li class="history-item"><span class="history-date">2025/06/12</span><span class="history-desc">PDF結合ロジック修正</span></li>
            <li class="history-item"><span class="history-date">2024/07/21</span><span class="history-desc">評価システム導入</span></li>
            <li class="history-item"><span class="history-date">2024/07/20</span><span class="history-desc">匿名掲示板オープン　詳細については、下を御覧ください。</span></li>
            <li class="history-item"><span class="history-date">2024/06/26</span><span class="history-desc">サービス開始</span></li>
          </ul>
        </div>
      </div>

      <div class="aqua-card bbs-card">
        <div class="card-content">
          <h2 class="card-title">匿名掲示板（外部サービス使用）</h2>
          <div class="indent left-align">
            これら匿名掲示板では、主に次のような情報を共有することを目的として用意しました。<br>
            完全匿名ですぐに利用できます。<br><br>
            
            <strong class="info-highlight">★平均点の報告</strong><br>
            　クラス平均点100点を目指そう！<br><br>
            
            <strong class="info-highlight">★テストの共有（写真投稿機能あり）</strong><br><br>
            <strong class="info-highlight">★過去問と一致している科目の報告</strong><br><br>
            <strong class="info-highlight">★試験への対策について。</strong><br><br><br>
            
            <strong class="info-highlight">掲示板リンク</strong><br>
            <div class="button-container">
              <button class="aqua-btn bbs-btn" onclick="window.open('https://c.kuku.lu/hmc853pz', '_blank')">
                <i class="fa-solid fa-comments"></i>
                <span>全体の部屋</span>
              </button>
              <button class="aqua-btn bbs-btn" onclick="window.open('https://c.kuku.lu/wxamr3rk', '_blank')">
                <i class="fa-solid fa-users"></i>
                <span>３年生の部屋</span>
              </button>
              <button class="aqua-btn bbs-btn" onclick="window.open('https://c.kuku.lu/shwzzu7z', '_blank')">
                <i class="fa-solid fa-users"></i>
                <span>２年生の部屋</span>
              </button>
              <button class="aqua-btn bbs-btn" onclick="window.open('https://c.kuku.lu/xpgpbn7k', '_blank')">
                <i class="fa-solid fa-users"></i>
                <span>１年生の部屋</span>
              </button>
              <button class="aqua-btn bbs-btn" onclick="window.open('https://c.kuku.lu/rk6hxege', '_blank')">
                <i class="fa-solid fa-user-tie"></i>
                <span>運営者と話す部屋</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="aqua-card about-card">
        <div class="card-content">
          <h2 class="card-title">このサービスについて</h2>
          <div class="indent justify">
            私が1年生で受けた「歴史総合」の考査を前年の問題と比較したところ、年度の数字が一つ増えただけでした。さらに、2年生で受けた「公共」の試験問題は、過去問と一致している部分が8割を超えていました。評定に関わる考査で、いくら授業が同じ内容だとはいえ前年の問題をほとんど同じく出題すべきではないと考えます。入試に関わらない教科であっても、過去問を手に入れることで勉強時間を他の重要な科目に充てることができます。<br><br>
            
            このサービスは、先輩とのつながりがない人でも過去問を利用できることを目指し、平均点を異常に高くし、将来的にコピペしただけの考査問題を絶滅させることを目的としたプロジェクトです。<br><br>
            
            このサービスは個人で運営しています。サービス維持には皆さんのご協力が必要です。ぜひ、過去問のアップロードやこのサイトの共有・拡散をよろしくお願いします。<br>
          </div>
        </div>
      </div>

      <div class="aqua-card share-card">
        <div class="card-content">
          <h2 class="card-title">共有・拡散</h2>
          <p class="text-center margin-bottom">
            秋高考査村を友達やクラス、学校に広めて<br>みんなで過去問を共有しよう
          </p>
        
          <div class="sharecontents">
            <input 
              type="text" 
              id="siteUrl" 
              class="share-input" 
              value="https://akt-kosamura.github.io/kosamura/?OpenExternalBrowser=1" 
              readonly
            >
            
            <div class="copy-button-container">
              <button class="aqua-btn secondary rounded" id="copyBtn" onclick="copyButton('siteUrl')">
                <i class="fa-regular fa-copy"></i>
                <span>コピー</span>
              </button>
            </div>
            
            <div class="share-buttons">
              <a
                id="twitterBtn"
                href="https://twitter.com/intent/tweet?text=無料＆匿名で使える過去問共有サイト「秋高考査村」%0A考査問題に限らず、テスト問題をアップロード・閲覧できるサービスです。%0A%0Ahttps://akt-kosamura.github.io/kosamura/?OpenExternalBrowser=1%0A%0A%23考査村%20%23過去問"
                class="aqua-btn share-btn"
                target="_blank" 
                rel="noopener noreferrer"
              >
                <i class="fa-brands fa-twitter"></i>
                <span>ツイート</span>
              </a>
              <button class="aqua-btn share-btn" id="nativeShareBtn">
                <i class="fa-solid fa-share-nodes"></i>
                <span>共有</span>
              </button>
            </div>
            
            <button class="aqua-btn print-btn" onclick="showPrintTemplateModal()">
              <i class="fa-solid fa-print"></i> 印刷用テンプレート
            </button>
            
            <div class="divider-container">
              <a href="https://forms.gle/ZWtQCvecH4eZtTEU7" class="aqua-btn secondary rounded" target="_blank">
                <i class="fa-solid fa-envelope"></i>
                <span>問い合わせフォーム</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div class="admin-login-container">
    <a href="#" id="adminLoginBtn" class="aqua-btn admin-login-btn">
      <i class="fa-solid fa-user-shield"></i>管理画面へ
    </a>
  </div>

  <div id="adminLoginModal" class="admin-modal">
    <div class="admin-modal-content">
      <div class="admin-modal-title">暗証番号</div>
      <input id="adminPinInput" type="password" inputmode="numeric" maxlength="4" pattern="[0-9]*" class="admin-pin-input" autocomplete="one-time-code" />
      <div id="adminPinError" class="admin-pin-error"></div>
      <div class="pin-grid">
        <button class="pin-btn">1</button><button class="pin-btn">2</button><button class="pin-btn">3</button>
        <button class="pin-btn">4</button><button class="pin-btn">5</button><button class="pin-btn">6</button>
        <button class="pin-btn">7</button><button class="pin-btn">8</button><button class="pin-btn">9</button>
        <div></div><button class="pin-btn">0</button><button class="pin-btn" id="pinDelBtn">⌫</button>
      </div>
      <button id="adminPinSubmit" class="aqua-btn admin-pin-submit">OK</button>
      <button id="adminPinCancel" class="aqua-btn admin-pin-cancel">キャンセル</button>
    </div>
  </div>

  <div class="copyright-note">Copyright© 2024 考査村 All Rights Reserved.</div>

  <div id="copyToast" class="toast">コピーしました！</div>

  <!-- 印刷用テンプレートモーダル -->
  <div id="printTemplateModal" class="print-modal">
    <div class="print-modal-content">
      <div class="print-modal-title">印刷用テンプレート</div>
      <div class="print-modal-body">
        <p class="print-modal-description">選択してダウンロード</p>
        <div class="print-modal-links">
          <a href="assets/documents/ミニカード.pdf" download class="print-modal-link">
            <i class="fa-regular fa-file-pdf"></i>
            <span>1. ミニカード (.pdf)</span>
          </a>
          <a href="assets/documents/短冊.pdf" download class="print-modal-link">
            <i class="fa-regular fa-file-pdf"></i>
            <span>2. 短冊型PDF (.pdf)</span>
          </a>
          <a href="assets/documents/宣伝用.jtd" download class="print-modal-link">
            <img src="assets/jtd_icon.gif" alt="一太郎アイコン" class="jtd-icon">
            <span>3. 元ファイル (.jtd)　 ※複数シート</span>
          </a>
        </div>
      </div>
      <button id="printTemplateClose" class="aqua-btn print-modal-close">閉じる</button>
    </div>
  </div>

  <script src="assets/js/api.js"></script>
  <script src="assets/js/auth.js"></script>
  <script>
    // ナビゲーション機能
    const navToggle = document.getElementById('navToggle');
    const navMenu = document.getElementById('navMenu');
    let isMenuOpen = false;

    navToggle.addEventListener('click', (e) => {
      e.preventDefault();
      isMenuOpen = !isMenuOpen;
      navToggle.classList.toggle('active');
      navMenu.classList.toggle('active');
      
      if (navigator.vibrate) {
        navigator.vibrate(50);
      }
    });

    // コピー機能
    function copyButton(elementId) {
      const element = document.getElementById(elementId);
      const text = element.value || element.textContent;
      
      navigator.clipboard.writeText(text).then(() => {
        showToast('コピーしました！');
        
        const btn = document.getElementById('copyBtn');
        const originalContent = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-check"></i><span>コピー完了</span>';
        btn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
        
        setTimeout(() => {
          btn.innerHTML = originalContent;
          btn.style.background = '';
        }, 2000);
      }).catch(() => {
        showToast('コピーに失敗しました');
      });
    }

    function showToast(message) {
      const toast = document.getElementById('copyToast');
      toast.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 2500);
    }

    // 統計情報読み込み
    async function loadStats() {
      try {
        const gasUrl = 'https://script.google.com/macros/s/AKfycbwEAhdiJOtbf44ifY-BoAFhLI7eQl_uIJKm9NDTexoWZD7U8l-7wsrT9ufRCZ9d8lZf/exec';
        const response = await fetch(`${gasUrl}?function=getStats`);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const stats = await response.json();
        
        let totalPosts, totalLikes, activeUsers;
        
        if (stats.result) {
          totalPosts = stats.result.totalPosts || 0;
          totalLikes = stats.result.totalLikes || 0;
          activeUsers = stats.result.activeUsers || 0;
        } else {
          totalPosts = stats.totalPosts || 0;
          totalLikes = stats.totalLikes || 0;
          activeUsers = stats.activeUsers || 0;
        }
        
        document.getElementById('totalPosts').textContent = Number(totalPosts).toLocaleString();
        document.getElementById('totalLikes').textContent = Number(totalLikes).toLocaleString();
        document.getElementById('activeUsers').textContent = Number(activeUsers).toLocaleString();
      } catch (error) {
        console.error('統計情報の読み込みに失敗しました:', error);
        document.getElementById('totalPosts').textContent = '0';
        document.getElementById('totalLikes').textContent = '0';
        document.getElementById('activeUsers').textContent = '0';
      }
    }

    // 印刷用テンプレートモーダル
    function showPrintTemplateModal() {
      const modal = document.getElementById('printTemplateModal');
      if (modal) {
        modal.style.display = 'flex';
        setTimeout(() => {
          modal.style.opacity = '1';
        }, 10);
        document.body.style.overflow = 'hidden';
      }
    }

    function closePrintTemplateModal() {
      const modal = document.getElementById('printTemplateModal');
      if (modal) {
        modal.style.opacity = '0';
        setTimeout(() => {
          modal.style.display = 'none';
          document.body.style.overflow = '';
        }, 200);
      }
    }

    // 管理画面ログイン
    const adminLoginBtn = document.getElementById('adminLoginBtn');
    const adminLoginModal = document.getElementById('adminLoginModal');
    const adminPinInput = document.getElementById('adminPinInput');
    const adminPinError = document.getElementById('adminPinError');
    const adminPinSubmit = document.getElementById('adminPinSubmit');
    const adminPinCancel = document.getElementById('adminPinCancel');
    const adminPinBtns = document.querySelectorAll('.pin-btn');
     
    let pinValue = '';
    
    function openAdminModal() {
      adminLoginModal.style.display = 'flex';
      adminPinInput.value = '';
      pinValue = '';
      adminPinError.textContent = '';
    }
    
    function closeAdminModal() {
      adminLoginModal.style.display = 'none';
    }
    
    adminLoginBtn.onclick = function(e) {
      e.preventDefault();
      openAdminModal();
    };
    
    adminPinCancel.onclick = function() {
      closeAdminModal();
    };
    
    adminPinSubmit.onclick = tryAdminLogin;
    
    adminPinInput.oninput = function(e) {
      pinValue = adminPinInput.value.replace(/\D/g, '').slice(0,4);
      adminPinInput.value = pinValue;
      adminPinError.textContent = '';
    };
    
    adminPinInput.onkeydown = function(e) {
      if (e.key === 'Enter') tryAdminLogin();
      if (e.key === 'Backspace' && pinValue.length > 0) {
        pinValue = pinValue.slice(0, -1);
        adminPinInput.value = pinValue;
        e.preventDefault();
      }
    };
    
    adminPinBtns.forEach(btn => {
      btn.onclick = function() {
        if (btn.id === 'pinDelBtn') {
          pinValue = pinValue.slice(0, -1);
        } else if (pinValue.length < 4) {
          pinValue += btn.textContent;
        }
        adminPinInput.value = pinValue;
        adminPinError.textContent = '';
      };
    });
    
    function tryAdminLogin() {
      if (pinValue === '0611') {
        closeAdminModal();
        window.open('admin/admin.html', '_blank', 'noopener');
      } else {
        adminPinError.textContent = '正しくありません';
        adminPinInput.value = '';
        pinValue = '';
      }
    }
    
    adminLoginModal.onclick = function(e) {
      if (e.target === adminLoginModal) closeAdminModal();
    };

    // ページ読み込み時の処理
    document.addEventListener('DOMContentLoaded', () => {
      loadStats();
      
      const printTemplateClose = document.getElementById('printTemplateClose');
      const printTemplateModal = document.getElementById('printTemplateModal');
      
      if (printTemplateClose) {
        printTemplateClose.addEventListener('click', closePrintTemplateModal);
      }
      
      if (printTemplateModal) {
        printTemplateModal.addEventListener('click', function(e) {
          if (e.target === this) {
            closePrintTemplateModal();
          }
        });
      }
      
      // ESCキーでモーダルを閉じる
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closePrintTemplateModal();
          closeAdminModal();
        }
      });
    });
  </script>
</body>
</html>
